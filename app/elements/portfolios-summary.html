<dom-module id='portfolios-summary'>
  <style>
  /*.top_line{
    font-weight:500;
    font-size:12px;
  }*/
  /*.see_all_projects{
    color:#0099ff;
    font-size:24px;
    font-weight:400;
    padding:0px;
    margin:0px;
  }*/
  .top_sum{
    font-weight:400;
    font-size:24px;
  }

  .pie_explanation{
    text-align:center;
    font-size: 18px;
    line-height: 24px;
    font-weight:400;
    padding:10px;
  }

  .portfolios{
    font-size:12px;
    font-weight:500;
    padding-left:5px;
  }

  .portfolio_stats{
    font-size:12px;
  }

  .circle {
    border-radius: 50%;
    width: 20px !important;
    height: 20px !important;
  }

  .project-youth_engagement .circle {
    background-color: #ffcc33;
  }
  .project-real_time_information  .circle {
    background-color: #ff3366;
  }
  .project-infrastructure .circle {
    background-color:#66cc66;
  }

  .project-technical_assistance .circle {
    background-color:#555555;
  }
  .project-fund_management .circle {
    background-color:#b1b1b1;
  }
  .project-knowledge_products .circle {
    background-color:teal;
  }
  .cell{
    font-size:12px;text-align:left; padding:5px;
  }

  .row{
    margin-bottom:5px;
  }
  </style>

  <template>
    <iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query>
    <firebase-document
      app-name="test"
      path="/summary"
      data="{{summary}}">
    </firebase-document>

    <div>
      <div style='text-align:center;padding-left:20px;'>
        <div class="bubble" style="text-align:center;border-color: rgb(127, 127, 127); min-height: 120px; top: 40px; border-width: 0px; background-color: rgb(255, 255, 255);">
          <div class="pointer" style="content: '';position: absolute;border-style: solid;border-width: 15px 9px 0;border-color: #FFFFFF transparent;display: block;width: 0;z-index: 1;bottom: -15px;left: 111px;">
          </div>
          <div class="pointerBorder" style="display: none">
          </div>
          <br /><br />
          <div class="content-grid mdl-grid" style='font-weight:800;font-size:12px;'>
            <div class="mdl-cell mdl-cell--6-col">
              <div style="height:40px;">
                INNOVATION FUND
              </div>
                <br>
              <div class='top_sum'>
                {{to_mil(summary.stats.total_available)}}
              </div>
            </div>
            <div class="mdl-cell mdl-cell--6-col">
              <div style="height:40px;">
                CO FUNDING LEVERAGED
              </div>
                <br>
              <div class='top_sum'>
                {{to_mil(summary.stats.co_funding)}}
              </div>
            </div>
          </div>
        </div>
      </div>
      <br>
      <div style='text-align:center;'>
        <hr style='width:80%;margin:auto;' />
      </div>

      <div class='pie_explanation'>
        {{to_mil(summary.stats.total_invested)}} has been invested in {{summary.stats.num_projects}} projects in {{summary.stats.num_countries}} countries.
      </div>
      <br>
      <br>
      <div style='text-align:center;'>

        <chart-pie data="[[process_for_pie(summary)]]" options="[[options]]" style="display:block !important;"></chart-pie>
      </div>
      <br>
      <div>

        <div class='portfolio_stats'>
          <div class='mdl-grid'>
            <div class="mdl-cell mdl-cell--12-col" >
              <div class='portfolios'>
                PORTFOLIOS
              </div>
              <div style='text-align:center;'>
                <hr  />
              </div>
            </div>
          </div>
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--2-col mdl-cell--1-col-tablet mdl-cell--1-col-phone project-youth_engagement" >
              <div class="circle">&nbsp;</div>
            </div>
            <div class="mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--2-col-phone">
              PRODUCTS FOR YOUTH
            </div>
            <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
              {{to_mil(summary.portfolios.invested_youth_engagement.amount)}}
            </div>
          </div>
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--2-col mdl-cell--1-col-tablet mdl-cell--1-col-phone project-real_time_information" >
              <div class="circle">&nbsp;</div>
            </div>
            <div class="mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--2-col-phone">
              REAL-TIME INFORMATION
            </div>
            <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
              {{to_mil(summary.portfolios.invested_real_time_information.amount)}}
            </div>
          </div>
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--2-col mdl-cell--1-col-tablet mdl-cell--1-col-phone project-infrastructure">
              <div class="circle">&nbsp;</div>
            </div>
            <div class="mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--2-col-phone">
              INFRASTRUCTURE
            </div>
            <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
              {{to_mil(summary.portfolios.invested_infrastructure.amount)}}
            </div>
          </div>

          <br>
          <div class='mdl-grid'>
            <div class="mdl-cell mdl-cell--12-col" >
              <div class='portfolios'>
                OTHERS
              </div>
              <div style='text-align:center;'>
                <hr  />
              </div>
            </div>
          </div>
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--2-col mdl-cell--1-col-tablet mdl-cell--1-col-phone project-technical_assistance">
              <div class="circle">&nbsp;</div>
            </div>
            <div class="mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--2-col-phone">
              TECHNICAL ASSISTANCE
            </div>
            <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
              {{to_mil(summary.portfolios.invested_technical_assistance.amount)}}
            </div>
          </div>
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--2-col mdl-cell--1-col-tablet mdl-cell--1-col-phone project-fund_management">
              <div class="circle">&nbsp;</div>
            </div>
            <div class="mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--2-col-phone">
              FUND MANAGEMENT
            </div>
            <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
              {{to_mil(summary.portfolios.invested_fund_management.amount)}}
            </div>
          </div>
          <div class="mdl-grid">
            <div class="mdl-cell mdl-cell--2-col mdl-cell--1-col-tablet mdl-cell--1-col-phone project-knowledge_products">
              <div class="circle">&nbsp;</div>
            </div>
            <div class="mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--2-col-phone">
              KNOWLEDGE PRODUCTS
            </div>
            <div class="mdl-cell mdl-cell--3-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
              {{to_mil(summary.portfolios.invested_knowledge_products.amount)}}
            </div>
          </div>
        </div>
      </div>
      <br>
      <!-- <hr style='padding:0px;margin:0px;'/>
      <div class="mdl-grid see_all_projects">
        <div class="mdl-layout-spacer"></div>
        <div class="mdl-cell mdl-cell--8-col cell">
          <span style='font-size:14px;font-weight:14px;'>See All Projects</span>
        </div>
        <div class="mdl-cell mdl-cell--2-col cell" >
          <i class="material-icons" style="background-color:white; color:#0099ff;">chevron_right</i>
        </div>
      </div>
    </div> -->
  </template>

</dom-module>

<script>
  function divide_by_100k(str_dollar_amount){
    var num = Number(str_dollar_amount.replace(/[^0-9\.]+/g,""))
    return num/1000;

  }

  Polymer({
    is: 'portfolios-summary',

    to_mil: function(num){
      if(num){
        num = Number(num.replace(/[^0-9\.]+/g,""))
        return cleanToMil(num);
      }
      return;
    },
    _summary: function(summary){

    },

    process_for_pie: function(data){

      data = data.portfolios;

      if(!data){
        return;
      }
      var portfolios = Object.keys(data);

      return {
        labels: portfolios.map(function(e){return data[e].label}),
        datasets: [
          {
            data: portfolios.map(function(e){return divide_by_100k(data[e].amount)}),
            backgroundColor: portfolios.map(function(e){return data[e].color}),
            hoverBackgroundColor: portfolios.map(function(e){return data[e].color})
          }
        ]
      }

    },

    properties: {
      data: {
        value: {
          labels: [
            "Products for youth",
            "Real-time information",
            "Infrastructure",
            "Technical assistance",
            "Fund Management",
            "Knowledge products"
          ],
          datasets: [
            {
              data: [918, 431, 110, 179, 286, 79],
              backgroundColor: [
                "#ffcc33",
                "#ff3366",
                "#66cc66",
                "#555555",
                "#b1b1b1",
                "teal"
              ],
              hoverBackgroundColor: [
                "#ffcc33",
                "#ff3366",
                "#66cc66",
                "#555555",
                "#b1b1b1",
                "teal"
              ]
            }]
        }
      },

      options: {
        type: Object,
        notify: true,
        value: function() {
          return {
             'width':1400,
             'legend':'none'
          }
        }
      },

      summary: {
        type: Object,
        notify: true,
        observer: '_summary'
      },

      svg: {
        value: '',
        notify: true
      }
    }
  })
</script>
